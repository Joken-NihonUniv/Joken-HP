# 仕様書的なの

## 0. index
1. [必要な機能](#anchor1)
2. [アカウント機能](#anchor2)
     1. [データベース](#anchor2-1)
            1. [各カラムについて](#anchor2-1-1)
     2. [登録画面](#anchor2-2)
     3. [ログイン画面](#anchor2-3)
3. [Wiki機能](#anchor3)
     1. [使用用途](#anchor3-1)
     2. [機能](#anchor3-2)

<a id="anchor1"></a>
## 1. 必要な機能
- アカウント機能(そこから学生課提出用の名簿を作成したりするため)
    - 学生番号(後述する脆弱性？があるためログインには不使用。代わりにIDを使用する)
    - ID
    - パスワード
- Wiki機能
    - 講習会やサークルの運営などで使用可能
    - 投稿ページ
        - マークダウン記法で記述する
        - 画像投稿可能
    - 閲覧ページ
        - Goodボタン
        - ストックボタン
        - コメント機能
    - バックエンド
        - PHPでマークダウンをデータベースにぶち込む
- 個人ページ
    - アカウント関連
        - アカウント名変更
        - パスワード変更
        - アイコン変更
    - 過去投稿記事
        - 投稿順に並べる
        - このページで投稿記事の削除可能
    - ストックした記事
- 広報(ニュース機能)
    - 最新5件をトップページにリスト表示
    - ニュースの投稿は管理ページより行う
    - 閲覧ページはWiki機能から以下の機能をなくしたもの
        - Goodボタン
        - ストックボタン
        - コメント機能
- 管理ページ
    - アカウント編集機能
        - 全アカウントのリスト表示
            - 以下の条件での絞り込み
                - アクティブユーザー(最終ログインが50日以内)
                - 学年ごと
                - 学生番号
                - 役職
            - 昇順、降順のソート(なくてもいいかも)
        - アカウントの役職変更
        - アカウント削除
        - Joken会員の名簿出力(CSV形式)
    - 広報管理
        - 投稿記事の一覧表示
        - 投稿記事の削除
        - 記事の新規投稿
    - サイトの設定

<a id="anchor2"></a>
## 2. アカウント機能
アカウント新規登録画面にて以下の内容を登録する
- 学生番号
- ID(Twiterと同じように@以降のユニークなIDを自分で決める)
- アカウント名
- パスワード
- 住所

<a id="anchor2-1"></a>
### 2-1. データベース
以下のカラムを設定する
No. | カラム | データ型 | データ範囲 | 制約 | 備考
--- | --- | --- | --- | --- | ---
01 | **num** | UNSIGNED INT | 0 - 16777215 | NOT NULL, UNIQUE, AI | 会員番号(主キー)
02 | **id** | VARCHAR(10) | 最大10文字 | NOT NULL, UNIQUE | @以降のID(任意の英数字列)
03 | **std_num** | INT | - | NOT NULL | 学生番号
04 | **name** | VARCHAR(20) | 最大20文字 | NOT NULL | アカウント名
05 | **icon** | VARCHAR(150) | - | NOT NULL | アカウントのアイコンのURL
06 | **address** | VARCHAR(100) | - | NOT NULL | 住所(名簿作成時に必要)
07 | **role** | TINYINT | - | NOT NULL | 役職
08 | **register** | DATE | - | NOT NULL | 登録日
09 | **last_login** | DATETIME | - | - | 最終ログイン日時
10 | **deleted** | TYNYINT | 0 or 1 | NOT NULL | 論理削除用(初期値は0)

<a id="anchor2-1-1"></a>
#### 2-1-1. 各カラムについて
##### 2-1-1-01. num
会員番号(自動付番)である。システム内部での処理にのみ用いられるのでユーザーは意識しなくてもよい

##### 2-1-1-02. id
後述の理由により学生番号ではなくIDでログインを行う

IDの仕様は以下のように定める
- 1文字から10文字とする
- 任意の英数字とし、記号はアンダースコア `"_"` のみ使用可能とする
- IDは他のユーザーと同じものを使ってはいけない
- 大文字と小文字を区別する

##### 2-1-1-03. std_num
学生番号  
ログインには使用しない

###### 2-1-1-03-1. 学生番号をログインに使用しない理由
学生番号は以下のフォーマットとなっている  
`306065`または`30605`  
これは、先頭の2桁で入学年度(**和暦**)を表しており、次の一桁(例の場合は`6`)で、所属学科を表している。  
次の二桁、もしくは三桁で学生番号を表している。この桁数が6桁であれば学部生、5桁であれば大学院生となっている。

ここで問題なのが、先頭二桁の**和暦で入学年度を表す方式**である。  
これだと、改元の際にリセットが行われるため、学生番号が卒業生と在校生でカブりが発生する危険性がある。そのため、主キーとしては使用不可能であり、代わりにIDを使用することにした。

##### 2-1-1-04. name
アカウント名である。20文字以内の任意の文字列とする。

##### 2-1-1-05. icon
アカウントのアイコンURLを格納する。  
アカウント登録時点では初期アイコンのURLを自動格納し、後でマイページよりアイコンを変更した場合に変更される

##### 2-1-1-06. address
利用者の住所。名簿作成以外の用途では使用しない。  
外部者の場合、この欄には`no_address`が格納される。

##### 2-1-1-07. role
役職である。0から7の範囲で付番される。初期値は0  
管理ページから変更可能である。

以下に役職とそれに伴った権限を示す
role番号 | 役職 | 権限レベル | Wiki投稿 | 管理ページアクセス | 広報新規投稿 | メンバー情報編集 | 名簿ダウンロード
--- | --- | --- | --- | --- | --- | --- | ---
0 | 一般会員 | 1 | ○ | × | × | × | ×
1 | 会計 | 3 | ○ | ○ | ○ | ○ | ○
2 | 副会長 | 3 | ○ | ○ | ○ | ○ | ○
3 | 会長 | 3 | ○ | ○ | ○ | ○ | ○
4 | 各班長, 宴会部長| 3 | ○ | ○ | ○ | ○ | ○
5 | 卒業生 | 2 | ○ | ○ | ○ | × | ×
6 | 指導教員 | 3 | ○ | ○ | ○ | ○ | ○
7 | 外部者 | 0 | × | × | × | × | ×

外部者はWiki閲覧(全員に公開されたもののみ)と広報のみ閲覧可能である。  
これWiki投稿もOKにしたほうが良いかな？？

##### 2-1-1-08. register
アカウントの登録日である。

##### 2-1-1-09. last_login
最終ログイン。アクティブユーザーか否かを判断するために必要

##### 2-1-1-10. deleted
論理削除を行うため、削除されたアカウントは1とし、非表示とし、ログイン不可とする。これによりデータベースをごにょごにょすると復活することが可能  
- 0: アカウントは有効(初期値)
- 1: アカウントは無効

<a id="anchor2-2"></a>
### 2-2. 登録画面
画面は1ページとし、以下のフォームを配置する
- 学生番号(テキストボックス)
- ID(テキストボックス)
- パスワード(テキストボックス)
- 役職の選択メニュー(ドロップダウンリスト)
- アカウント名
- 住所(情報研究会員, 情報研究会幹部陣のみ)
    - それ以外の役職の場合`no_address`が自動格納される(フォームは無効化される)
- 登録ボタン(submitボタン)

<a id="anchor2-3"></a>
### 2-3. ログイン画面
画面は1ページとし、以下のフォームを配置する
- ID(テキストボックス)
- パスワード(テキストボックス)
- ログインボタン(submitボタン)

<a id="anchor3"></a>
## 3. Wiki機能

<a id="anchor3-1"></a>
### 3-1. 使用用途
- 講習会
- サークル運営手続きメモ等

<a id="anchor3-2"></a>
### 3-2. 機能
これらを実現するために以下の機能が必要とされる
- マークダウン記法対応
- 画像投稿対応
- タグ機能対応
- コメント機能対応
- Good機能
- ストック機能

<a id="anchor3-3"></a>
### 3-3. データベース
#### 3-3-1. CONTENT
No. | カラム名 | データ型 | 制約 | 備考
--- | --- | --- | --- | ---
01 | article_id | INT | PRIMARY | 記事ID (主キー)
02 | author | INT | NOT NULL | 書いた人のID
03 | title | VARCHAR(30) | NOT NULL | タイトル
04 | detail | VARCHAR(65,535) | NOT NULL | 記事本文
05 | Secret | TINYINT | NOT NULL | 公開範囲
06 | deleted | TINYINT | NOT NULL | 論理削除用

#### 3-3-2. TAGS
No. | カラム名 | データ型 | 制約 | 備考
--- | --- | --- | --- | ---
01 | tag_id | INT | PRIMARY | 主キー
02 | tag | VARCHAR(20) | NOT NULL, UNIQUE | タグ名

#### 3-3-3. *テーブル名なんかいいのないすか？*
No. | カラム名 | データ型 | 制約 | 備考
--- | --- | --- | --- | ---
01 | join_id | INT | PRIMARY | 主キー
02 | article_id | INT | NOT NULL | 記事ID
03 | tag_id | INT | NOT NULL | タグID
