# 仕様書的なの

## 1. 必要な機能
- アカウント機能(そこから学生課提出用の名簿を作成したりするため)
  - 学生番号(後述する脆弱性？があるためログインには不使用。代わりにIDを使用する)
  - ID
  - パスワード
- Wiki機能
  - 講習会やサークルの運営などで使用可能
  - 投稿ページ
    - マークダウン記法で記述する
    - 画像投稿可能
  - 閲覧ページ
    - Goodボタン
    - ストックボタン
    - コメント機能
  - バックエンド
    - PHPでマークダウンをデータベースにぶち込む
- 個人ページ
  - アカウント関連
    - アカウント名変更
    - パスワード変更
    - アイコン変更
  - 過去投稿記事
    - 投稿順に並べる
    - このページで投稿記事の削除可能
  - ストックした記事
- 広報(ニュース機能)
  - 最新5件をトップページにリスト表示
  - ニュースの投稿は管理ページより行う
  - 閲覧ページはWiki機能から以下の機能をなくしたもの
    - Goodボタン
    - ストックボタン
    - コメント機能
- 管理ページ
  - アカウント編集機能
    - 全アカウントのリスト表示
      - 以下の条件での絞り込み
        - アクティブユーザー(最終ログインが50日以内)
        - 学年ごと
        - 学生番号
        - 役職
      - 昇順、降順のソート(なくてもいいかも)
    - アカウントの役職変更
    - アカウント削除
    - Joken会員の名簿出力(CSV形式)
  - 広報管理
    - 投稿記事の一覧表示
    - 投稿記事の削除
    - 記事の新規投稿
  - サイトの設定

## 2. アカウント機能
アカウント新規登録画面にて以下の内容を登録する
- 学生番号
- ID(Twiterと同じように@以降のユニークなIDを自分で決める)
- アカウント名
- パスワード

### 2-1. データベース
以下のカラムを設定する
No. | カラム | データ型 | データ範囲 | 制約 | 備考
--- | --- | --- | --- | --- | ---
1 | **num** | UNSIGNED INT | 0 - 16777215 | NOT NULL, UNIQUE, AI | 会員番号(主キー)
2 | **id** | VARCHAR(10) | 最大10文字 | NOT NULL, UNIQUE | @以降のID(任意の英数字列)
3 | **std_num** | INT | - | NOT NULL | 学生番号
4 | **name** | VARCHAR(20) | 最大20文字 | NOT NULL | アカウント名
5 | **role** | TINYINT | - | NOT NULL | 役職
6 | **register** | DATE | - | NOT NULL | 登録日
7 | **last_login** | DATETIME | - | - | 最終ログイン日時

#### 2-1-1. 各カラムについて
##### 2-1-1-1. num
会員番号(自動付番)である。システム内部での処理にのみ用いられるのでユーザーは意識しなくてもよい

##### 2-1-1-2. id
後述の理由により学生番号ではなくIDでログインを行う

IDの仕様は以下のように定める
- 1文字から10文字とする
- 任意の英数字とし、記号はアンダースコア `"_"` のみ使用可能とする
- IDは他のユーザーと同じものを使ってはいけない
- 大文字と小文字を区別する

##### 2-1-1-3. std_num
学生番号  
ログインには使用しない

###### 2-1-1-3-1. 学生番号をログインに使用しない理由
学生番号は以下のフォーマットとなっている  
`306065`または`30605`  
これは、先頭の2桁で入学年度(**和暦**)を表しており、次の一桁(例の場合は`6`)で、所属学科を表している。  
次の二桁、もしくは三桁で学生番号を表している。この桁数が6桁であれば学部生、5桁であれば大学院生となっている。

ここで問題なのが、先頭二桁の**和暦で入学年度を表す方式**である。  
これだと、改元の際にリセットが行われるため、学生番号が卒業生と在校生でカブりが発生する危険性がある。そのため、主キーとしては使用不可能であり、代わりにIDを使用することにした。

##### 2-1-1-4. name
アカウント名である。20文字以内の任意の文字列とする。

##### 2-1-1-5. role
役職である。0から5の範囲で付番される。初期値は0  
管理ページから変更可能である。

以下に役職とそれに伴った権限を示す
role番号 | 役職 | 権限レベル | Wiki投稿 | 管理ページアクセス | 広報新規投稿 | メンバー情報編集 | 名簿ダウンロード
--- | --- | --- | --- | --- | --- | --- | ---
0 | 一般会員 | 1 | ○ | × | × | × | ×
1 | 会計 | 3 | ○ | ○ | ○ | ○ | ○
2 | 副会長 | 3 | ○ | ○ | ○ | ○ | ○
3 | 会長 | 3 | ○ | ○ | ○ | ○ | ○
4 | 卒業生 | 2 | ○ | ○ | ○ | × | ×
5 | 指導教員 | 2 | ○ | ○ | ○ | × | ×
6 | 外部者 | 0 | × | × | × | × | ×

外部者はWiki閲覧(全員に公開されたもののみ)と広報のみ閲覧可能である。  
これWiki投稿もOKにしたほうが良いかな？？

